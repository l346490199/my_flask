# 开始的地方

## 第一个程序

```python
from flask import Flask
app = Flask(__name__)

@app.route("/")
def index():
    return '<h1>Hello Flask! </h1>'
```

1. `__name__`表示文件的名称(app)，导入到类Flask中去.
2. 注册路由 通过app.route()装饰器,注册路由(route).
3. `'/'`表示跟路由,在这里将和视图函数index绑定
4. return返回的就是给大家看的页面
5. 一个视图函数可以绑定多个路由(URL)
6. `@app.route("/hi/<name>")`动态URL `http://127.0.0.1:5000/hi/lq` 将"lq"导入到变量name中,进入到视图函数中去运算
   1. `@app.route("/hi",defaults={"name":"Programmer"})` 另一种动态URL `http://127.0.0.1:5000/hi?name=lq`

## 第一次运行

`$ flask run`

* 默认网址`http://127.0.0.1:5000/` 127.0.0.1即localhost
* 默认端口为5000,可以通过`--port=80`进行更改,或者环境变量'FLASK_RUN_HOST'和'FLASK_RUN_PORT'来进行设定
* 可以通过设置`--host=0.0.0.0`使外部可见   可以使用ngrok,Localtunnel等工具对外部可见

## 环境变量 

`.env` 和`.flaskenv`

flaskenv储存和Flask相关的公开环境变量,例如FLASK_APP;<br>
env用来储存包含敏感信息的环境变量,例如Email设置中的账号密码;sql相关信息<br>
文件中以#开头的是注释

## 运行环境

分为开发环境和生产环境,默认为 Production 生产环境,可在flaskenv中加入`FLASK_ENV=development`,这时激活了'Werkzeug'中的调试器(debugger)和重载器(reloader),推荐安装'watchdog'.  

## 交互式

`$ flask shell`

## Flask扩展

扩展(exteension)即使用Flask提供的API接口编写的Python库,可以为Flask程序添加各种各样的功能.

## 项目配置

在Flask中,配置变量就是一些大写形式的Python变量,你也可以称为配置参数或配置键.
这些配置变量通过Flask对象的app.config属性作为统一的接口来设置和获取.

## 自定义Flask命令

`@app.cli.command()` 装饰器  

```python
@app.cil.command('say-hello')
def hello ():
    """Just say hello."""
    click.eecho("hello,Human!)
```

完整的使用命令:`$ flask hello` 或者 `$ flask say-hello`  
命令 `$ flask --help` 可以查看到我们自定义的命令

## 模板和静态文件

```base
hello/
    - templates/
    - static/
    - app.py
```

* templates为模板文件
* static为静态文件

## 关键字

* Response(响应)
* Request(请求)
* response message : 响应报文
  * 请求的方法、URL、协议版本、首部字段(header)及内容实体组成
* request message : 请求报文
* message : 报文
* methods : 监听HTTP方法
  * GET | HEAD | POST | PUT | DELETE | OPTIONS; PUT | DELETE 一般不出现在程序中实现,最常用的是GET 

## HTTP请求

| 信息           | 说明                                          |
| -------------- | --------------------------------------------- |
| http://        | 协议字符串,指定要使用的协议                   |
| helloflask.com | 服务器地址(域名)                              |
| /hello?name=lq | 要获取的资源路径(path),类似UNIX的文件目录结构 |

## Request对象

请求对象Request，里面封装了从客户端发来的请求报文.  
常用的属性`ages` 是个字典

## 处理请求

### flask routes 显示视图

`$ flask routes`
可以查看所有视图 显示一个列表

| Endpoint   | Methods | Rule                                |
| ---------- | ------- | ----------------------------------- |
| hi         | GET     | /hi,defaults={"name": "Programmer"} |
| hi         | GET     | /hi/\<name\>                        |
| index      | GET     | /                                   |
| just_flash | GET     | /flash                              |  |
| static     | GET     | /static/<path:filename>             |

**static**为Flask添加的特殊端点,用来访问静态文件的.  

### 监听HTTP的方法

### URL处理方法

`/hi/<int:year>`表示 `<转换器:变量名>`

内置URL变量转换器
| 转换器 | 说明                                                                   |
| ------ | ---------------------------------------------------------------------- |
| string | 不包含斜线的字符串(默认)                                               |
| int    | 整型                                                                   |
| float  | 浮点数                                                                 |
| path   | 包含斜线的字符串,static路由的URL规则中的filename变量就使用了这个转换器 |
| any    | 匹配一系列给定值中的一个元素                                           |
| uuid   | UUID字符串                                                             |

any最为特殊,示例如下

```python
colors = [blue,white,red]

@app.route('colors/<any(%s):color'% str(colors)[1:-1])
@app.route("/colors/<any(blue,white,red):color>")
def three_colors(color):
    return "<p>Love is patient and Kind. Love is not jealous or boastful or proud or rude.</p>"
```

### 请求钩子

<br><br>

## 响应报文
